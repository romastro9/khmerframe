<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Khmer Frame</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f0f2f5; color:#050505; }
  header { background:#1877F2; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
  header h1 { margin:0; font-size:1.5rem; font-weight:bold; }
  header .lang-btn { background:white; color:#1877F2; border:none; border-radius:5px; padding:6px 12px; cursor:pointer; font-weight:bold; margin-top:5px; }

  main { max-width:1200px; margin:20px auto; display:grid; grid-template-columns:1fr 1fr; gap:20px; padding:0 10px; }
  .panel { background:white; border-radius:10px; padding:20px; box-shadow:0 2px 6px rgba(0,0,0,0.15); }
  .panel h2 { margin-top:0; color:#1877F2; }
  input[type=file] { display:block; margin:10px 0; width:100%; }

  #previewImg {
    width:100%; 
    max-width:100%;
    border-radius:10px;
    border:1px solid #ccc;
    background:#fff;
  }

  footer { text-align:center; margin:30px 10px; font-size:0.9rem; color:#555; }
  footer a { color:#1877F2; text-decoration:none; margin-left:5px; }

  @media (max-width:768px){ main{grid-template-columns:1fr;} }
</style>
</head>
<body>
<header>
  <h1>Khmer Frame</h1>
  <button class="lang-btn" id="langBtn">ភាសាខ្មែរ</button>
</header>

<main>
  <div class="panel">
    <h2 id="panelTitle">Upload Images</h2>
    <label id="photoLabel">Photo (required):</label>
    <input type="file" id="photoInput" accept="image/*">
    <label id="frameLabel">Frame PNG (optional):</label>
    <input type="file" id="frameInput" accept="image/*">
  </div>
  <div class="panel">
    <h2>Preview</h2>
    <!-- show final merged image -->
    <img id="previewImg" alt="Preview">
  </div>
</main>

<footer>
  រៀបរៀងដោយ Moung Phearom |
  ប៉ាវកាហ្វេអ្នកផលិត (<a href="https://abapayment.vercel.app/" target="_blank">https://abapayment.vercel.app/</a>) |
  <a href="https://t.me/Romastro9" target="_blank"><i class="fab fa-telegram"></i> Telegram</a>
</footer>

<script>
let lang='en';
const text={
  en:{uploadPhoto:'Photo (required):', uploadFrame:'Frame PNG (optional):', panel:'Upload Images', langBtn:'ភាសាខ្មែរ'},
  kh:{uploadPhoto:'រូបភាព (ចាំបាច់):', uploadFrame:'ស៊ុម PNG (បន្ថែម):', panel:'អាប់ឡូដរូបភាព', langBtn:'English'}
};
const langBtn=document.getElementById('langBtn');
const photoLabel=document.getElementById('photoLabel');
const frameLabel=document.getElementById('frameLabel');
const panelTitle=document.getElementById('panelTitle');

langBtn.addEventListener('click',()=>{
  lang=lang==='en'?'kh':'en';
  photoLabel.textContent=text[lang].uploadPhoto;
  frameLabel.textContent=text[lang].uploadFrame;
  panelTitle.textContent=text[lang].panel;
  langBtn.textContent=text[lang].langBtn;
});

const photoInput=document.getElementById('photoInput');
const frameInput=document.getElementById('frameInput');
const previewImg=document.getElementById('previewImg');

let photoImg=null, frameImg=null;

function mergeImages(){
  if(!photoImg) return;
  const canvas=document.createElement('canvas');
  const size=1080;
  canvas.width=size; canvas.height=size;
  const ctx=canvas.getContext('2d');

  const scale=Math.max(size/photoImg.width, size/photoImg.height);
  const dw=photoImg.width*scale, dh=photoImg.height*scale;
  const dx=(size-dw)/2, dy=(size-dh)/2;
  ctx.drawImage(photoImg,dx,dy,dw,dh);
  if(frameImg) ctx.drawImage(frameImg,0,0,size,size);

  previewImg.src=canvas.toDataURL('image/png');
}

photoInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(file){
    photoImg=new Image();
    photoImg.src=URL.createObjectURL(file);
    photoImg.onload=mergeImages;
  }
});
frameInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(file){
    frameImg=new Image();
    frameImg.src=URL.createObjectURL(file);
    frameImg.onload=mergeImages;
  }
});
</script>
</body>
</html>
